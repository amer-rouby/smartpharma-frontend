<mat-toolbar color="primary" class="header-toolbar">

  <!-- Right Side -->
  <div class="header-right">

    <button mat-icon-button (click)="toggleSidebar.emit()" class="toggle-sidebar-btn" matTooltip="القائمة الرئيسية">
      <mat-icon>menu</mat-icon>
    </button>

    <div class="logo-section" routerLink="/dashboard">
      <div class="logo-icon">
        <mat-icon>local_pharmacy</mat-icon>
      </div>
      <div class="logo-text-container">
        <span class="logo-text">صيدليتي الذكية</span>
        <span class="logo-subtitle">نظام إدارة الصيدليات</span>
      </div>
    </div>
  </div>

  <!-- Center: Search -->
  <div class="header-center">
    <div class="search-wrapper">
      <mat-form-field appearance="outline" class="search-field">
        <input matInput [value]="searchQuery()" (input)="searchQuery.set($any($event.target).value)"
          (keyup.enter)="onSearch()" (keydown)="onSearchKeydown($event)" placeholder="ابحث عن منتج، دواء، أو تقرير...">
        <mat-icon matPrefix>search</mat-icon>

        @if (searchQuery()) {
        <button mat-icon-button matSuffix (click)="clearSearch()" type="button">
          <mat-icon>close</mat-icon>
        </button>
        }
      </mat-form-field>
    </div>
  </div>

  <!-- Left Side: Actions -->
  <div class="header-left">

    <!-- Quick Add -->
    <button mat-stroked-button class="quick-add-btn" [matMenuTriggerFor]="quickActionsMenu">
      <mat-icon>add</mat-icon>
      <span>جديد</span>
    </button>

    <mat-menu #quickActionsMenu="matMenu" class="quick-actions-menu" xPosition="before">
      @for (action of quickActions; track action.route) {
      <button mat-menu-item [routerLink]="action.route">
        <mat-icon [color]="action.color">{{action.icon}}</mat-icon>
        <span>{{action.label}}</span>
      </button>
      }
      <mat-divider></mat-divider>
      <button mat-menu-item routerLink="/reports">
        <mat-icon>assessment</mat-icon>
        <span>تقرير جديد</span>
      </button>
    </mat-menu>

    <!-- Notifications -->
    <button mat-icon-button [matMenuTriggerFor]="notificationMenu" [matBadge]="notificationCount()" matBadgeColor="warn"
      class="notification-btn">
      <mat-icon>notifications</mat-icon>
    </button>

    <mat-menu #notificationMenu="matMenu" class="notification-menu" xPosition="before">
      <div class="menu-header">
        <h3>الإشعارات</h3>
        @if (notificationCount() > 0) {
        <button mat-button color="primary" (click)="markAllAsRead()">
          تحديد الكل كمقروء
        </button>
        }
      </div>
      <mat-divider></mat-divider>

      @if (unreadNotifications().length > 0) {
      <div class="notification-list">
        @for (notification of unreadNotifications(); track notification.id) {
        <button mat-menu-item (click)="markAsRead(notification.id)">
          <div class="notification-icon" [class]="notification.type">
            <mat-icon>{{notification.icon}}</mat-icon>
          </div>
          <div class="notification-content">
            <span class="notification-message">{{notification.message}}</span>
            <small class="notification-time">{{notification.time}}</small>
          </div>
        </button>
        }
      </div>
      } @else {
      <div class="no-notifications">
        <mat-icon>notifications_none</mat-icon>
        <p>لا توجد إشعارات جديدة</p>
      </div>
      }
    </mat-menu>

    <!-- User Profile -->
    <button mat-button [matMenuTriggerFor]="userMenu" class="user-profile-btn">
      <div class="user-info-mini">
        <div class="user-avatar">
          <mat-icon>account_circle</mat-icon>
        </div>
        <div class="user-details">
          <span class="user-name">{{userDisplayName()}}</span>
          <span class="user-role">{{userDisplayRole()}}</span>
        </div>
        <mat-icon class="dropdown-arrow">expand_more</mat-icon>
      </div>
    </button>

    <mat-menu #userMenu="matMenu" class="user-menu user-menu-wide" xPosition="before" yPosition="below">

      <div class="user-menu-header">
        <!-- <div class="user-avatar-large">
          <mat-icon>account_circle</mat-icon>
        </div> -->
        <div class="user-menu-info">
          <p mat-menu-item class="user-menu-name">
            <mat-icon>account_circle</mat-icon>
            <span>{{userDisplayName()}}</span>
          </p>
          <!-- <p class="user-menu-email">{{userDisplayEmail()}}</p> -->
        </div>
      </div>

      <mat-divider></mat-divider>

      <button mat-menu-item routerLink="/settings/profile">
        <mat-icon>person_outline</mat-icon>
        <span>الملف الشخصي</span>
      </button>

      <button mat-menu-item routerLink="/settings">
        <mat-icon>settings</mat-icon>
        <span>الإعدادات</span>
      </button>

      <button mat-menu-item routerLink="/help">
        <mat-icon>help_outline</mat-icon>
        <span>المساعدة</span>
      </button>

      <mat-divider></mat-divider>

      <button mat-menu-item (click)="logout()" class="logout-item">
        <mat-icon>exit_to_app</mat-icon>
        <span>تسجيل الخروج</span>
      </button>
    </mat-menu>

  </div>
</mat-toolbar>
